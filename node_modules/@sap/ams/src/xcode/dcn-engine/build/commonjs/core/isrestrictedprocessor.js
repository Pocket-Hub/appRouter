"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _and = _interopRequireDefault(require("./condition/and.js"));
var _comparisonoperator = _interopRequireDefault(require("./condition/comparisonoperator.js"));
var _false = _interopRequireDefault(require("./condition/false.js"));
var _not = _interopRequireDefault(require("./condition/not.js"));
var _not_restricted = _interopRequireDefault(require("./condition/not_restricted.js"));
var _or = _interopRequireDefault(require("./condition/or.js"));
var _restricted = _interopRequireDefault(require("./condition/restricted.js"));
var _true = _interopRequireDefault(require("./condition/true.js"));
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
/**
 * @typedef {import('./core/condition/condition.js').default} Condition
 */

/**
 * @param {Condition} condition 
 * @param {Object.<string,Condition[]>} restrictions 
 * @returns {Condition}
 */
function resolveIsRestricted(condition, restrictions) {
  if (condition instanceof _restricted.default) {
    const ref = condition.values[0].reference;
    return restrictions[ref] ?? new _false.default();
  }
  if (condition instanceof _not_restricted.default) {
    const ref = condition.values[0].reference;
    return restrictions[ref] ?? new _true.default();
  }
  if (condition instanceof _comparisonoperator.default) {
    // hence no changes, we don't need to copy
    return condition;
  }
  if (condition instanceof _or.default) {
    return _or.default.create(condition.conditions.map(c => resolveIsRestricted(c, restrictions)));
  }
  if (condition instanceof _and.default) {
    return _and.default.create(condition.conditions.map(c => resolveIsRestricted(c, restrictions)));
  }
  if (condition instanceof _not.default) {
    return new _not.default(resolveIsRestricted(condition.condition, restrictions));
  }
  if (condition instanceof _true.default || condition instanceof _false.default) {
    return condition;
  }
  throw new Error(`unexpected condition type`);
}
var _default = exports.default = resolveIsRestricted;