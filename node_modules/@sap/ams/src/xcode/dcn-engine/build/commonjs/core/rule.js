"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _and = _interopRequireDefault(require("./condition/and.js"));
var _in = _interopRequireDefault(require("./condition/in.js"));
var _true = _interopRequireDefault(require("./condition/true.js"));
var _value = _interopRequireDefault(require("./condition/value.js"));
var _dcn = _interopRequireDefault(require("./dcn.js"));
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
/**
 * @typedef {import('./core/condition/condition.js').default} Condition
 */

class Rule {
  actions = [];
  resources = [];
  condition = undefined;
  fromUse = [];
  static fromDCN(dcnRule, schema) {
    const rule = new Rule();
    if (dcnRule.rule !== "grant") {
      throw new Error(`unexpected rule "${dcnRule.rule}". only "grant" is supported.`);
    }
    rule.actions = dcnRule.actions ?? [];
    rule.resources = dcnRule.resources ?? [];
    if (dcnRule.condition) {
      rule.condition = _dcn.default.condition(dcnRule.condition, schema);
    } else {
      rule.condition = new _true.default();
    }
    return rule;
  }

  /**
   * @returns {Condition}
    */
  toCondition() {
    let conditions = [];
    if (this.actions.length) {
      conditions.push(new _in.default(_value.default.fromDcn({
        ref: ["$dcl", "action"]
      }), _value.default.fromDcn(this.actions)));
    }
    if (this.resources.length) {
      conditions.push(new _in.default(_value.default.fromDcn({
        ref: ["$dcl", "resource"]
      }), _value.default.fromDcn(this.resources)));
    }
    conditions.push(this.condition);
    return _and.default.create(conditions);
  }
}
exports.default = Rule;