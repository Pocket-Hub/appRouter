const fetch = require("node-fetch");

async function run(request, responseType) {
  const response = await fetch(request.url, request);
  if (response.status !== 200) {
    const errtext = await response.text();
    throw new Error(response.status + " - " + errtext);
  }

  if(responseType == "json") {
    return response.json();
  } else if(responseType == "buffer") {
    return response.buffer();
  }
}

module.exports = class NodeFetchHttpClient {
  async uploadDCL(request) {   
    return run(request, "json");
  }

  async downloadBundle(request) {
    return run(request, "buffer");
  }
};