const { addDefaultHeaders, createHTTPSAgent } = require('./common');
const httpClient = require("./httpClient");

function prepareDownload(identity) {
  //return a config object suiteable for all http clients
  const ret = {
    url: `${identity.authorization_bundle_url}/${identity.authorization_instance_id}.tar.gz`,
    method: "GET",
    host: identity.url,
    headers: {},
    agent: createHTTPSAgent(identity)
  };

  addDefaultHeaders(ret.headers, identity);
  return ret;
}

module.exports = async function(credentials) {
    const options = prepareDownload(credentials);
    return httpClient.downloadBundle(options);
}
